version: '3'

networks:
  core-infra:
    external: true

services:
  keycloak:
      image: fnext/keycloak:0.0.1
      environment:
        DB_VENDOR: h2
        KEYCLOAK_USER: admin
        KEYCLOAK_PASSWORD: xxxxx
      volumes:
        - /nfs/docker/keycloak/data:/opt/jboss/keycloak/standalone/data
      networks:
       - core-infra
      ports:
        - 8081:8080
      deploy:
        mode: replicated
        replicas: 1
        placement:
          constraints:
            - "node.hostname == fnext-padellion"
        labels:
          - traefik.enable=true
          - traefik.docker.network=core-infra
          - traefik.http.routers.keycloak-https-redirect.tls=true
          - traefik.http.routers.keycloak-https.entrypoints=idp-secure
          - traefik.http.routers.keycloak-https.tls=true
          - traefik.http.services.keycloak-https.loadbalancer.server.port=8080
          - traefik.http.routers.keycloak-https.rule=Host(`developer.florencenext.com`)